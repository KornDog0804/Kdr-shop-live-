<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>KDR â€¢ KornDog Records</title>
  <link rel="icon" href="/korndog_logo.png"/>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap');
    
    :root{
      --bg1:#3b2aa2;
      --bg2:#0fa77f;
      --ink:#eaf4ff;
      --muted:#b6c2d1;
      --card:#0b1220;
      --accent:#7c4dff;
      --green: hsl(142.1, 76.2%, 36.3%);
      --green-hover: hsl(142.1, 76.2%, 46.3%);
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    html, body { height: 100%; }
    
    body {
      font-family: 'Inter', sans-serif;
      color: var(--ink);
      background: radial-gradient(1200px 800px at 25% 20%, rgba(255,255,255,.05), transparent 60%), 
                  linear-gradient(135deg, var(--bg1), var(--bg2));
      min-height: 100%;
    }
    
    a { color: inherit; text-decoration: none; }
    
    /* Navigation */
    .nav {
      background: rgba(11, 18, 32, 0.9);
      backdrop-filter: blur(8px);
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      position: sticky;
      top: 0;
      z-index: 50;
      padding: 1rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .nav-brand {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--green);
      cursor: pointer;
      transition: color 0.2s;
    }
    
    .nav-brand:hover {
      color: var(--green-hover);
    }
    
    .nav-links {
      display: flex;
      gap: 2rem;
      align-items: center;
    }
    
    .nav-links a {
      color: var(--ink);
      text-decoration: none;
      padding: 0.5rem 1rem;
      border-radius: 0.375rem;
      transition: all 0.2s;
      position: relative;
    }
    
    .nav-links a:hover {
      color: var(--green);
    }
    
    .nav-links a.active {
      color: var(--green);
      border-bottom: 2px solid var(--green);
    }
    
    .badge {
      background: #121827;
      border: 1px solid #243041;
      color: #a3d2ff;
      border-radius: 999px;
      padding: 4px 8px;
      font-size: 12px;
      margin-left: 6px;
    }
    
    .btn {
      background: #0e1624;
      border: 1px solid #253146;
      color: #d7e3f4;
      border-radius: 10px;
      padding: 8px 12px;
      cursor: pointer;
      text-decoration: none;
      display: inline-block;
      transition: all 0.2s;
    }
    
    .btn:hover {
      background: #151f31;
    }
    
    .btn-primary {
      background: var(--green);
      border-color: var(--green);
      color: white;
    }
    
    .btn-primary:hover {
      background: var(--green-hover);
    }
    
    /* Pages */
    .page {
      display: none;
      min-height: calc(100vh - 80px);
    }
    
    .page.active {
      display: block;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 2rem;
    }
    
    /* Hero Section */
    .hero-section {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
    }
    
    .hero-title {
      font-size: 4rem;
      font-weight: 900;
      color: white;
      margin-bottom: 1rem;
      text-shadow: 0 4px 8px rgba(0,0,0,0.3);
    }
    
    .hero-subtitle {
      font-size: 1.5rem;
      color: rgba(255,255,255,0.9);
      margin-bottom: 2rem;
    }
    
    .hero-logo {
      width: 200px;
      height: 200px;
      background: rgba(255,255,255,0.2);
      border-radius: 1rem;
      backdrop-filter: blur(8px);
      border: 1px solid rgba(255,255,255,0.3);
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 2rem auto;
      cursor: pointer;
      transition: all 0.3s;
      color: white;
      font-size: 1.5rem;
      font-weight: 700;
      text-align: center;
      line-height: 1.2;
    }
    
    .hero-logo:hover {
      background: rgba(255,255,255,0.3);
      transform: scale(1.05);
    }
    
    /* Product Cards */
    .grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 14px;
    }
    
    @media (min-width: 720px) {
      .grid {
        grid-template-columns: repeat(4, minmax(0, 1fr));
      }
    }
    
    .card {
      background: rgba(0, 0, 0, .25);
      border: 1px solid rgba(255, 255, 255, .08);
      border-radius: 14px;
      overflow: hidden;
      perspective: 900px;
    }
    
    .card-inner {
      position: relative;
      transform-style: preserve-3d;
      transition: transform .6s cubic-bezier(.2, .6, .2, 1);
    }
    
    .card.flip .card-inner {
      transform: rotateY(180deg);
    }
    
    .card-face {
      position: relative;
      backface-visibility: hidden;
    }
    
    .card-face.back {
      transform: rotateY(180deg);
      position: absolute;
      inset: 0;
      padding: 12px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }
    
    .card img {
      display: block;
      width: 100%;
      height: 160px;
      object-fit: cover;
      background: var(--card);
    }
    
    .item-title {
      font-weight: 700;
      margin: 10px 10px 4px;
    }
    
    .price {
      margin: 0 10px 12px;
      color: #c4e6ff;
    }
    
    .condition {
      margin: 0 10px 4px;
      color: var(--muted);
      font-size: 0.875rem;
    }
    
    .row {
      display: flex;
      gap: 8px;
      align-items: center;
    }
    
    .qty {
      display: flex;
      gap: 6px;
      align-items: center;
      margin-left: auto;
    }
    
    .qty input {
      width: 46px;
      background: var(--card);
      border: 1px solid #253146;
      color: #e6f1ff;
      border-radius: 8px;
      padding: 6px;
    }
    
    .add {
      margin: 0 10px 12px;
      width: calc(100% - 20px);
    }
    
    .add .btn {
      width: 100%;
    }
    
    .section-title {
      margin: 28px 0 10px;
      font-size: 22px;
    }
    
    /* Drawer Cart */
    .drawer {
      position: fixed;
      top: 0;
      right: -420px;
      width: 420px;
      max-width: 92vw;
      height: 100dvh;
      background: var(--card);
      border-left: 1px solid #273244;
      transition: right .28s ease;
      z-index: 50;
      color: var(--ink);
      display: flex;
      flex-direction: column;
    }
    
    .drawer.open {
      right: 0;
    }
    
    .drawer header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 14px 16px;
      border-bottom: 1px solid #223045;
    }
    
    .drawer main {
      flex: 1;
      overflow: auto;
      padding: 12px;
    }
    
    .cart-item {
      display: flex;
      gap: 10px;
      padding: 10px;
      border: 1px solid #223045;
      border-radius: 10px;
      margin-bottom: 10px;
    }
    
    .cart-item img {
      width: 64px;
      height: 64px;
      object-fit: cover;
      border-radius: 8px;
    }
    
    .cart-item .grow {
      flex: 1;
    }
    
    .drawer footer {
      border-top: 1px solid #223045;
      padding: 12px;
    }
    
    .small {
      font-size: 12px;
      color: #9fb4c9;
    }
    
    .paypal {
      margin-top: 10px;
    }
    
    /* KornDog Popup */
    .korndog-popup {
      position: fixed;
      bottom: 20px;
      right: 20px;
      z-index: 1000;
      background: white;
      border-radius: 20px;
      padding: 20px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      max-width: 320px;
      animation: slideIn 0.5s ease-out;
      color: #1a1a1a;
    }
    
    .korndog-popup.hidden {
      display: none;
    }
    
    .korndog-character {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 1rem;
      position: relative;
      overflow: hidden;
    }
    
    .korndog-character img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    .korndog-message h3 {
      font-weight: 700;
      margin-bottom: 0.5rem;
      color: #1a1a1a;
    }
    
    .korndog-message p {
      margin-bottom: 1rem;
      color: #666;
      line-height: 1.4;
    }
    
    .korndog-actions {
      display: flex;
      gap: 0.5rem;
    }
    
    .korndog-close {
      position: absolute;
      top: 10px;
      right: 15px;
      background: none;
      border: none;
      font-size: 20px;
      cursor: pointer;
      color: #999;
    }
    
    /* Kitty Messages */
    .kitty-popup {
      position: fixed;
      bottom: 20px;
      left: 20px;
      z-index: 1000;
      animation: bounce-in 0.5s ease-out;
    }
    
    .kitty-image {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 1rem;
      animation: bounce 2s infinite;
      overflow: hidden;
    }
    
    .kitty-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    .speech-bubble {
      position: relative;
      background: white;
      border: 3px solid #333;
      border-radius: 20px;
      padding: 15px 20px;
      color: #333;
      font-weight: bold;
      max-width: 250px;
      animation: speech-bubble 0.4s ease-out;
    }
    
    .speech-bubble:after {
      content: '';
      position: absolute;
      bottom: -20px;
      left: 30px;
      width: 0;
      height: 0;
      border: 20px solid transparent;
      border-top-color: white;
      border-bottom: 0;
      margin-left: -20px;
      margin-bottom: -20px;
    }
    
    .speech-bubble:before {
      content: '';
      position: absolute;
      bottom: -23px;
      left: 30px;
      width: 0;
      height: 0;
      border: 23px solid transparent;
      border-top-color: #333;
      border-bottom: 0;
      margin-left: -23px;
      margin-bottom: -23px;
    }
    
    /* About Page */
    .content-card {
      background: white;
      border-radius: 1rem;
      padding: 3rem;
      color: #1a1a1a;
      box-shadow: 0 8px 32px rgba(0,0,0,0.2);
      margin-top: 2rem;
    }
    
    .content-card h2 {
      color: #1a1a1a;
      margin-bottom: 1rem;
      margin-top: 2rem;
    }
    
    .about-text {
      line-height: 1.7;
      margin-bottom: 1.5rem;
    }
    
    .zombie-lore {
      background: #f9fafb;
      padding: 2rem;
      border-radius: 0.5rem;
      margin: 2rem 0;
    }
    
    /* Animations */
    @keyframes slideIn {
      0% { 
        opacity: 0; 
        transform: translateX(100px); 
      }
      100% { 
        opacity: 1; 
        transform: translateX(0); 
      }
    }
    
    @keyframes bounce-in {
      0% { opacity: 0; transform: scale(0.3); }
      50% { transform: scale(1.05); }
      70% { transform: scale(0.9); }
      100% { opacity: 1; transform: scale(1); }
    }
    
    @keyframes bounce {
      0%, 20%, 53%, 80%, 100% { transform: translateY(0); }
      40%, 43% { transform: translateY(-10px); }
      70% { transform: translateY(-5px); }
      90% { transform: translateY(-2px); }
    }
    
    @keyframes speech-bubble {
      0% { opacity: 0; transform: scale(0.8) translateY(10px); }
      100% { opacity: 1; transform: scale(1) translateY(0); }
    }
    
    @media (max-width: 768px) {
      .hero-title { font-size: 2.5rem; }
      .nav-links { display: none; }
      .container { padding: 1rem; }
      .grid { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <!-- Navigation -->
  <nav class="nav">
    <div class="nav-brand" onclick="showPage('home')">
      KDR â€¢ KornDog Records
      <span class="badge">live</span>
    </div>
    <div class="nav-links">
      <a href="#" onclick="showPage('home')" id="nav-home">Home</a>
      <a href="#" onclick="showPage('shop')" id="nav-shop">Shop</a>
      <a href="#" onclick="showPage('collectibles')" id="nav-collectibles">Collectibles</a>
      <a href="#" onclick="showPage('about')" id="nav-about">About</a>
      <button class="btn" id="cartBtn">Cart</button>
      <a href="#" onclick="showPage('admin')" id="nav-admin">Admin</a>
    </div>
  </nav>

  <!-- Home Page -->
  <div id="homePage" class="page active">
    <div class="hero-section">
      <div class="container">
        <h1 class="hero-title" id="headline">Fresh arrivals in the shop</h1>
        <p class="hero-subtitle" id="subhead">Kitties, records & Funkos</p>
        <div class="hero-logo" onclick="showPage('shop')">
          KornDog<br />Records
        </div>
        <p style="color: rgba(255,255,255,0.8); margin-top: 1rem;">Click to enter shop</p>
        <button class="btn btn-primary" onclick="showPage('shop')" style="margin-top: 2rem;">
          Enter Shop
        </button>
      </div>
    </div>
  </div>

  <!-- Shop Page -->
  <div id="shopPage" class="page">
    <div class="container">
      <header>
        <h1>Vinyl Records</h1>
        <p class="small">Hand-picked favorites â€¢ Vinyl therapy is always on deck</p>
      </header>
      <section id="vinyl-section">
        <div class="grid" id="grid-vinyl"></div>
      </section>
    </div>
  </div>

  <!-- Collectibles Page -->
  <div id="collectiblesPage" class="page">
    <div class="container">
      <header>
        <h1>Collectibles & Funkos</h1>
        <p class="small">Funkos & rare finds</p>
      </header>
      <section id="funkos-section">
        <h2 class="section-title">Funkos</h2>
        <div class="grid" id="grid-funkos"></div>
      </section>
    </div>
  </div>

  <!-- About Page -->
  <div id="aboutPage" class="page">
    <div class="container">
      <div class="content-card">
        <h1>About KornDog Records</h1>
        
        <div>
          <h2>About Me</h2>
          <p class="about-text">
            Music's always been in my blood â€” thanks to my mom and dad â€” but vinyl didn't hit me 'til after my mom's wreck. She didn't make it. That moment split my world in two. Records became therapy. No therapist. No pills. Just needle to groove. It grounded me. Every spin pulls me back â€” riding shotgun with my old man, laughing with my kids, slow dancing with my wife Brandi. This site? It's not about algorithms, trends, or fake hype. It's about soul. About stories. About memories pressed into wax. Every record here? Hand-picked. Every story? Real. Welcome to my therapy session. Hope you find yours.
          </p>
        </div>

        <div class="zombie-lore">
          <h2>Zombie Kitty Lore</h2>
          <p class="about-text">
            Zombie Kitty was born on Friday the 13th as a tattoo idea with my daughter. She's the spirit of every scar and every spin â€” stitched together from music, memories, and a little bit of chaos. When you add a record to your cart, she pops up with her blurbs â€” reminding you this isn't just shopping, it's resurrection. Every scratch, every groove is survival. Zombie Kitty lives in the vinyl, and she's never leaving.
          </p>
        </div>
      </div>
    </div>
  </div>

  <!-- Admin Page -->
  <div id="adminPage" class="page">
    <div class="container">
      <header>
        <h1>Admin Panel</h1>
        <p class="small">Content managed from <a href="/admin/" class="btn">Admin Dashboard</a></p>
      </header>
      <section id="current-inventory">
        <h2 class="section-title">Current Inventory</h2>
        <div class="grid" id="grid-admin"></div>
      </section>
      <section id="past-drops">
        <h2 class="section-title">Past Drops</h2>
        <div class="grid" id="grid-drops"></div>
      </section>
    </div>
  </div>

  <!-- Cart Drawer -->
  <aside class="drawer" id="drawer">
    <header>
      <strong>Your Cart</strong>
      <button class="btn" id="closeDrawer">Close</button>
    </header>
    <main id="cartList"></main>
    <footer>
      <div class="row"><span style="flex: 1;">Subtotal:</span><strong id="subtotal">$0.00</strong></div>
      <div class="small">Totals and taxes are calculated by PayPal.</div>
      <div id="paypalArea" class="paypal"></div>
      <button class="btn" id="clearCart" style="width:100%;margin-top:8px">Clear cart</button>
    </footer>
  </aside>

  <!-- KornDog Popup -->
  <div class="korndog-popup hidden" id="korndogPopup">
    <button class="korndog-close" onclick="dismissKorndog()">&times;</button>
    <div class="korndog-character">
      <img src="ChatGPT Image Aug 10, 2025, 12_07_42 AM.png" alt="KornDog" onerror="this.style.background='var(--green)'; this.innerHTML='ðŸŒ­';">
    </div>
    <div class="korndog-message">
      <h3 id="korndogHeadline">welcome to the kennel.</h3>
      <p id="korndogSubline">fresh wax, weird fun, zero skip.</p>
    </div>
    <div class="korndog-actions">
      <button class="btn btn-primary" onclick="emailJoey()">got questions? email joey</button>
      <button class="btn" onclick="dismissKorndog()">browse solo</button>
    </div>
  </div>

  <!-- Kitty Popup -->
  <div class="kitty-popup" id="kittyPopup" style="display: none;">
    <div class="kitty-image" id="kittyImageContainer">
      <img id="kittyImage" src="1000043471-removebg-preview.png" alt="Kitty">
    </div>
    <div class="speech-bubble" id="kittyMessage"></div>
  </div>

  <script>
    // Configuration
    window.KDR_CONFIG = {
      jsonKey: "content/live.json",
      bucketBase: "https://jii3i.upcloudobjects.com/korndog-media",
      currency: "USD"
    };

    // State management
    const state = {
      content: null,
      cart: JSON.parse(localStorage.getItem("kdr_cart") || "[]"),
      currentPage: 'home'
    };

    // KornDog greeting messages
    const KORNDOG_MESSAGES = {
      new: [
        { headline: "vinyl therapy, now spinning.", subline: "Kitties, records & Funkosâ€”hand-picked by KornDog." },
        { headline: "welcome to the kennel.", subline: "fresh wax, weird fun, zero skip." },
        { headline: "kdr is live.", subline: "hand-picked favorites + collectables." },
        { headline: "zombie kitty approves.", subline: "limited grooves & collectables inside." },
        { headline: "for the shelf & the soul.", subline: "hand-curated vinyl + pops." }
      ],
      returning: [
        { headline: "you made it. turntable time.", subline: "limited drops, legit grades, fast spins." },
        { headline: "needle down. mood up.", subline: "vinyl that feels like a memory." },
        { headline: "add joy to cart.", subline: "records, Funkos, and kitty chaos." },
        { headline: "fresh press, no stress.", subline: "new arrivals + past drops." },
        { headline: "spin first, thank us later.", subline: "NM to VG+â€”transparent grading." }
      ]
    };

    // Zombie Kitty messages
    const KITTY_MESSAGES = {
      vinyl: [
        "This groove's gonna haunt your dreams in the best way possible!",
        "Every scratch tells a story - this one's writing yours!",
        "Warning: May cause uncontrollable foot tapping and soul resurrection!",
        "This record has seen things... beautiful, melodic things!",
        "Found this gem in the vinyl graveyard - now it lives again!",
        "Trust me, I've got nine lives of musical experience!",
        "This spin will bring you back from the dead!",
        "Zombie approved - because even the undead need good music!",
        "Another soul saved by the power of vinyl!",
        "This record's got more lives than me - and that's saying something!"
      ],
      funko: [
        "Kawaii overload detected! This cutie's stealing my undead heart!",
        "Even zombies can appreciate this level of adorable!",
        "Warning: May cause extreme happiness and shelf envy!",
        "This collectible is so cute, it could raise the dead!",
        "Adding this to your collection? You've got excellent taste!",
        "Chibi magic at work - resistance is futile!",
        "This figure's cuter than a zombie kitty! (Almost...)",
        "Collectible status: Absolutely purr-fect!",
        "Your shelf called - it NEEDS this cuteness!",
        "Fair warning: This might be the cutest thing you ever own!"
      ]
    };

    // Utility functions
    const $ = (s, c = document) => c.querySelector(s);
    function fmt(n) { return `$${(Math.round(n * 100) / 100).toFixed(2)}`; }

    // Navigation
    function showPage(pageId) {
      // Hide all pages
      document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
      
      // Show selected page
      const targetPage = pageId + 'Page';
      document.getElementById(targetPage).classList.add('active');
      
      // Update navigation
      document.querySelectorAll('.nav-links a').forEach(link => {
        link.classList.remove('active');
        if (link.getAttribute('onclick') && link.getAttribute('onclick').includes(pageId)) {
          link.classList.add('active');
        }
      });
      
      state.currentPage = pageId;
    }

    // KornDog popup system
    function showKorndogPopup() {
      const isReturningVisitor = localStorage.getItem('kdr_visitor');
      const messagePool = isReturningVisitor ? KORNDOG_MESSAGES.returning : KORNDOG_MESSAGES.new;
      const randomMessage = messagePool[Math.floor(Math.random() * messagePool.length)];
      
      $('#korndogHeadline').textContent = randomMessage.headline;
      $('#korndogSubline').textContent = randomMessage.subline;
      
      $('#korndogPopup').classList.remove('hidden');
      
      // Mark as visited
      if (!isReturningVisitor) {
        localStorage.setItem('kdr_visitor', 'true');
      }
      
      // Auto-dismiss after 8 seconds
      setTimeout(() => {
        dismissKorndog();
      }, 8000);
    }

    function dismissKorndog() {
      $('#korndogPopup').classList.add('hidden');
    }

    function emailJoey() {
      window.location.href = 'mailto:tians.rule1215@gmail.com?subject=Question about KornDog Records&body=Hi Joey,%0D%0A%0D%0AI was browsing your site and wanted to ask...';
      dismissKorndog();
    }

    // Kitty popup system
    function showKittyMessage(category) {
      const messages = KITTY_MESSAGES[category];
      if (!messages) return;
      
      const randomMessage = messages[Math.floor(Math.random() * messages.length)];
      
      const popup = $('#kittyPopup');
      const image = $('#kittyImage');
      const message = $('#kittyMessage');
      
      // Set kitty image based on category
      if (category === 'vinyl') {
        image.src = '1000043471-removebg-preview.png'; // Zombie Kitty for vinyl
        image.alt = 'Zombie Kitty';
      } else {
        image.src = '1000044073-removebg-preview.png'; // Chibi Kitty for Funkos
        image.alt = 'Chibi Kitty';
      }
      
      message.textContent = randomMessage;
      popup.style.display = 'block';
      
      // Hide after 4 seconds
      setTimeout(() => {
        popup.style.display = 'none';
      }, 4000);
    }

    // Cart functionality
    function openDrawer() { $("#drawer").classList.add("open"); }
    function closeDrawer() { $("#drawer").classList.remove("open"); }

    function cardEl(item) {
      const el = document.createElement("div");
      el.className = "card";
      
      // Determine default image based on category
      let defaultImage = '';
      if (item.category === 'vinyl' || item.category === 'record') {
        defaultImage = 'ChatGPT Image Aug 10, 2025, 12_07_42 AM.png'; // KornDog logo for vinyl
      } else if (item.category === 'funko' || item.category === 'collectible') {
        defaultImage = 'ozzy_box.png'; // Ozzy Funko as default
      }
      
      const imageUrl = item.image || defaultImage;
      
      el.innerHTML = `<div class='card-inner'>
          <div class='card-face front'>
            <img alt='${item.title}' src='${imageUrl}' onerror="this.style.background='linear-gradient(135deg, #667eea 0%, #764ba2 100%)'; this.style.display='flex'; this.style.alignItems='center'; this.style.justifyContent='center'; this.innerHTML='<span style=\\"color:white;font-size:0.875rem;text-align:center;padding:1rem;\\">${item.title}</span>';"/>
            <div class='item-title'>${item.title}</div>
            ${item.condition ? `<div class='condition'>${item.condition}</div>` : ''}
            <div class='price'>${fmt(item.price)}</div>
          </div>
          <div class='card-face back'>
            <div>
              <div class='item-title'>${item.title}</div>
              <p class='small'>${item.description || 'Tap add to cart.'}</p>
            </div>
            <div class='row add'>
              <div class='qty'>
                <span class='small'>Qty</span>
                <input type='number' min='1' value='1'/>
              </div>
              <button class='btn addBtn'>Add</button>
            </div>
          </div>
        </div>`;
      
      el.addEventListener("click", () => el.classList.toggle("flip"));
      
      $(".addBtn", el).addEventListener("click", (e) => {
        e.stopPropagation();
        const qty = parseInt($("input", el).value || "1", 10);
        state.cart.push({ ...item, qty });
        localStorage.setItem("kdr_cart", JSON.stringify(state.cart));
        renderCart();
        openDrawer();
        
        // Show kitty message based on item category
        const kittyCategory = (item.category === 'vinyl' || item.category === 'record') ? 'vinyl' : 'funko';
        showKittyMessage(kittyCategory);
      });
      
      return el;
    }

    function renderCart() {
      const list = $("#cartList");
      list.innerHTML = "";
      let subtotal = 0;
      
      state.cart.forEach((ci, i) => {
        subtotal += ci.price * ci.qty;
        const row = document.createElement("div");
        row.className = "cart-item";
        row.innerHTML = `<img src='${ci.image}' onerror="this.style.background='#667eea'"/>
          <div class='grow'>
            <div><strong>${ci.title}</strong></div>
            <div class='small'>${ci.qty} Ã— ${fmt(ci.price)}</div>
          </div>
          <button class='btn' data-i='${i}'>Remove</button>`;
        
        $("button", row).addEventListener("click", () => {
          state.cart.splice(i, 1);
          localStorage.setItem("kdr_cart", JSON.stringify(state.cart));
          renderCart();
        });
        
        list.appendChild(row);
      });
      
      $("#subtotal").textContent = fmt(subtotal);
      
      // PayPal integration
      const area = $("#paypalArea");
      area.innerHTML = "";
      
      if (!state.content?.paypalBusiness) {
        const tip = document.createElement("div");
        tip.className = "small";
        tip.textContent = "Set paypalBusiness in Admin.";
        area.appendChild(tip);
      } else if (state.cart.length > 0) {
        const form = document.createElement("form");
        form.method = "post";
        form.action = "https://www.paypal.com/cgi-bin/webscr";
        form.target = "_blank";
        form.innerHTML = `<input type='hidden' name='cmd' value='_cart'/>
          <input type='hidden' name='upload' value='1'/>
          <input type='hidden' name='business' value='${state.content.paypalBusiness}'/>
          <input type='hidden' name='currency_code' value='USD'/>`;
        
        state.cart.forEach((ci, idx) => {
          const n = idx + 1;
          form.innerHTML += `<input type='hidden' name='item_name_${n}' value='${ci.title}'/>
            <input type='hidden' name='amount_${n}' value='${ci.price}'/>
            <input type='hidden' name='quantity_${n}' value='${ci.qty}'/>`;
        });
        
        const btn = document.createElement("button");
        btn.className = "btn btn-primary";
        btn.textContent = "Checkout with PayPal";
        btn.style.width = "100%";
        form.appendChild(btn);
        area.appendChild(form);
      }
    }

    function renderSection(id, list) {
      const grid = document.getElementById(id);
      if (!grid || !list) return;
      grid.innerHTML = "";
      list.forEach(it => grid.appendChild(cardEl(it)));
    }

    // Load content from cloud
    async function loadContent() {
      try {
        const url = `${window.KDR_CONFIG.bucketBase}/${window.KDR_CONFIG.jsonKey}`;
        const res = await fetch(url, { cache: "no-store" });
        const data = await res.json();
        state.content = data;
        
        // Update hero content
        $("#headline").textContent = data.hero?.headline || "Fresh arrivals in the shop";
        $("#subhead").textContent = data.hero?.subhead || "Kitties, records & Funkos";
        
        // Render sections
        const sections = data.sections || [];
        const funkos = sections.find(s => /funko/i.test(s.title))?.items || [];
        const vinyl = sections.find(s => /vinyl|record/i.test(s.title))?.items || [];
        const drops = data.pastDrops || [];
        
        // Add sample vinyl records if no content loaded
        if (vinyl.length === 0 && funkos.length === 0) {
          const sampleVinyl = [
            {
              id: "sleep-token-arcadia",
              title: "Sleep Token - Even in Arcadia",
              price: 95.00,
              condition: "NM/NM",
              category: "vinyl",
              description: "Translucent green pressing â€¢ Atmospheric metal masterpiece â€¢ Limited edition",
              image: "/images/sleep-token-arcadia.jpg"
            },
            {
              id: "sevendust-home",
              title: "Sevendust - Home", 
              price: 50.00,
              condition: "NM/NM",
              category: "vinyl",
              description: "European Import â€¢ Cream colored vinyl â€¢ Alt-metal essential",
              image: "/images/sevendust-home.jpg"
            },
            {
              id: "bfmv-poison",
              title: "Bullet For My Valentine - The Poison (20th Anniversary)",
              price: 35.00, 
              condition: "NM",
              category: "vinyl", 
              description: "Red vinyl anniversary pressing â€¢ Metalcore classic â€¢ Collector's edition",
              image: "/images/bfmv-poison-anniversary.jpg"
            }
          ];
          
          const sampleFunkos = [
            {
              id: "eddie-van-halen-funko",
              title: "Eddie Van Halen Funko Pop",
              price: 25.00,
              condition: "MINT",
              category: "funko",
              description: "Rocks Series #258 â€¢ Guitar legend with Frankenstrat â€¢ Classic rock collectible",
              image: "/images/eddie-van-halen-funko.jpg"
            },
            {
              id: "hot-tamales-funko",
              title: "Hot Tamales Funko Pop",
              price: 15.00,
              condition: "MINT",
              category: "funko",
              description: "Ad Icons #100 â€¢ Spicy candy mascot â€¢ Unique food character Pop",
              image: "/images/hot-tamales-funko.jpg"
            },
            {
              id: "jerry-lawler-funko",
              title: "Jerry 'The King' Lawler Metallic Funko Pop",
              price: 30.00,
              condition: "MINT",
              category: "funko",
              description: "WWE #97 â€¢ Metallic finish variant â€¢ Wrestling royalty with crown",
              image: "/images/jerry-lawler-metallic-funko.jpg"
            }
          ];
          
          renderSection("grid-vinyl", sampleVinyl);
          renderSection("grid-funkos", sampleFunkos);
          renderSection("grid-admin", [...sampleVinyl, ...sampleFunkos]);
        } else {
          renderSection("grid-funkos", funkos);
          renderSection("grid-vinyl", vinyl);
          renderSection("grid-drops", drops);
          renderSection("grid-admin", [...funkos, ...vinyl]); // Show all inventory in admin
        }
        
      } catch (e) {
        console.error("Failed to load content:", e);
      }
    }

    // Event listeners
    $("#cartBtn").addEventListener("click", openDrawer);
    $("#closeDrawer").addEventListener("click", closeDrawer);
    $("#clearCart").addEventListener("click", () => {
      state.cart = [];
      localStorage.setItem("kdr_cart", "[]");
      renderCart();
    });

    // Initialize
    document.addEventListener('DOMContentLoaded', function() {
      renderCart();
      loadContent();
      
      // Show KornDog popup after 2 seconds
      setTimeout(() => {
        showKorndogPopup();
      }, 2000);
    });
  </script>
</body>
</html>